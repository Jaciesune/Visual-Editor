<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:skia="clr-namespace:SkiaSharp.Views.Maui.Controls;assembly=SkiaSharp.Views.Maui.Controls"
             x:Class="VE.Views.MainPage"
             Title="Edytor graficzny">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Toolbar -->
            <RowDefinition Height="*"/>
            <!-- Główna treść -->
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto"/>
            <!-- Panel narzędzi -->
            <ColumnDefinition Width="*"/>
            <!-- Canvas i warstwy -->
            <ColumnDefinition Width="300"/>
            <!-- Panel warstw -->
        </Grid.ColumnDefinitions>

        <!-- Pasek narzędzi głównych -->
        <HorizontalStackLayout Grid.Row="0" Grid.ColumnSpan="3"
            Padding="4"
            Spacing="8"
            BackgroundColor="#23262B"
            HeightRequest="48">
            <Button Text="Nowy"
                TextColor="White"
                BackgroundColor="#393e46"
                FontAttributes="Bold"
                CornerRadius="6"/>
            <Button Text="Otwórz"
                TextColor="White"
                BackgroundColor="#393e46"
                FontAttributes="Bold"
                CornerRadius="6"
                Command="{Binding OpenImageCommand}"/>
            <Button Text="Zapisz"
                TextColor="White"
                BackgroundColor="#393e46"
                FontAttributes="Bold"
                CornerRadius="6"/>
        </HorizontalStackLayout>

        <!-- Lewy panel narzędzi rysowania -->
        <StackLayout Grid.Row="1" Grid.Column="0" BackgroundColor="#424242" Padding="18">
            <!-- Tytuł sekcji narzędzi -->
            <Label Text="Narzędzia"
           FontAttributes="Bold"
           FontSize="18"
           Margin="10,0,10,6"
           TextColor="White"/>

            <!-- Przyciski narzędzi -->
            <Button Text="Pędzel" Clicked="ShowBrushOptions"/>
            <!-- Panel opcji Pędzla -->
            <AbsoluteLayout HeightRequest="160">
                <Frame x:Name="BrushOptionsPanel"
                   AbsoluteLayout.LayoutBounds="0,0,220,150"
                   AbsoluteLayout.LayoutFlags="None"
                   IsVisible="False"
                   HasShadow="True"
                   BackgroundColor="#626262"
                   CornerRadius="9"
                   Padding="10">    
                <VerticalStackLayout>
                    <Label Text="Kolor pędzla (RGB):"
                        FontAttributes="Bold"
                        Margin="0,0,0,6"
                        TextColor="#23262B"/>

                    <HorizontalStackLayout Spacing="4">
                            <Entry Text="{Binding Brush.R, Mode=TwoWay, Converter={StaticResource RgbStringToIntConverter}}" WidthRequest="40" MaxLength="3" Keyboard="Numeric" Placeholder="R"/>
                            <Entry Text="{Binding Brush.G, Mode=TwoWay, Converter={StaticResource RgbStringToIntConverter}}" WidthRequest="40" MaxLength="3" Keyboard="Numeric" Placeholder="G"/>
                            <Entry Text="{Binding Brush.B, Mode=TwoWay, Converter={StaticResource RgbStringToIntConverter}}" WidthRequest="40" MaxLength="3" Keyboard="Numeric" Placeholder="B"/>
                    </HorizontalStackLayout>

                    <Label Text="Podgląd koloru:"
                       FontSize="13"
                       Margin="0,9,0,2"
                       TextColor="#23262B"/>

                        <Frame Padding="0"
                           Margin="0,0,0,10"
                           HeightRequest="36"
                           WidthRequest="68"
                           CornerRadius="7"
                           BorderColor="#393e46"
                           HasShadow="False"
                           VerticalOptions="Start">         
                        <BoxView Color="{Binding BrushColor}"
                             WidthRequest="60"
                             HeightRequest="28"
                             CornerRadius="6"
                             VerticalOptions="Center"/>
                        </Frame>
                    </VerticalStackLayout>
                </Frame>
            </AbsoluteLayout>

            <Button Text="Gumka"/>
            <Button Text="Wiadro"/>
            <Button Text="Pipeta"/>
        </StackLayout>

        <!-- Główny Canvas -->
        <Label Text="{Binding ImageLoadError}" TextColor="Red" FontSize="13"/>
        <ScrollView Grid.Row="1" Grid.Column="1" Orientation="Both" BackgroundColor="Transparent">
            <Frame 
                Margin="10"
                BackgroundColor="White"
                BorderColor="#AAAAAA"
                CornerRadius="4"
                WidthRequest="700"
                HeightRequest="450"
                HorizontalOptions="Center"
                VerticalOptions="Center">

                <skia:SKCanvasView x:Name="MainCanvas"
                    PaintSurface="MainCanvas_PaintSurface"
                    EnableTouchEvents="True"
                    Touch="MainCanvas_Touch"
                    WidthRequest="700"
                    HeightRequest="450"/>
            </Frame>
        </ScrollView>

        <!-- Panel warstw -->
        <StackLayout Grid.Row="1" Grid.Column="2" BackgroundColor="#525252" Padding="8">
            <Label Text="Warstwy" FontAttributes="Bold"/>
            <ListView>
                <!-- Placeholder -->
                <ListView.ItemsSource>
                    <x:Array Type="{x:Type x:String}">
                        <x:String>Tło</x:String>
                        <x:String>Warstwa 1</x:String>
                    </x:Array>
                </ListView.ItemsSource>
            </ListView>
            <Button Text="Dodaj warstwę" Margin="0,10,0,0"/>
        </StackLayout>
    </Grid>
</ContentPage>
